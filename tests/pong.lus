/* main = pong */
/* Do not remove the line above */

type dir = Left + Right

node lat_move(x : int) = (x2 : int)
with var dir : dir ; r_overflow, l_overflow : bool in
  r_overflow = x >= 800 ;
  l_overflow = x <= 0 ;
  dir = Right fby (
    if r_overflow then
      Left
    else
      if l_overflow then
        Right
      else
        dir
  ) ;
  x2 = merge dir (Left  -> x - 5 when Left(dir))
                 (Right -> x + 5 when Right(dir))

node hor_move(y : int) = (y2 : int)
with var overflow : bool; gradient : int in
  y2 = y + gradient ;
  overflow = (y2 >= 400) or (y2 < 0) ;
  gradient = 4 fby (if overflow then (- gradient) else gradient)

node pong(wind : int) = (x, y : int; paddle : int)
with var xx, yy : int in
  xx = lat_move(x) ;
  x = 100 fby xx ;
  yy = hor_move(y) ;
  y = 300 fby yy ;
  paddle = 200
